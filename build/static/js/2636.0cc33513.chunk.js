"use strict";(self.webpackChunkgithubit_dashboard=self.webpackChunkgithubit_dashboard||[]).push([[2636],{82636:function(e,t,d){d.r(t),d.d(t,{default:function(){return I}});var i=d(1413),n=d(29439),r=d(47313),a=d(18197),o=d(256),l=d(59491),u=d(68197),s=d(59624),c=d(72652),v=d(3250),y=d(26363),p=d(51835),_=d(44653),f=d(2717),m=d(7370),h=d(70816),Z=d.n(h),k=d(73270),x=d(58467),b=d(90954),g=d(22054),j=d(24511),D=d(1003),M=d(46417);function I(){var e=(0,j.$)().t,t=a.Z.useForm(),d=(0,n.Z)(t,1)[0],h=(0,f.I0)(),I=(0,x.UO)().id,Y=(0,x.s0)(),U=(0,r.useState)(!1),q=(0,n.Z)(U,2),H=q[0],w=q[1],C=(0,r.useState)(null),F=(0,n.Z)(C,2),S=F[0],N=F[1],A=(0,r.useState)(!1),B=(0,n.Z)(A,2),O=B[0],V=B[1],E=(0,f.v9)((function(e){return e.order}),f.wU),J=E.data,P=E.total,$=E.coupon,z=E.orderProducts,G=E.orderItems,K=(0,f.v9)((function(e){return e.currency}),f.wU).currencies,L=(0,f.v9)((function(e){return e.menu}),f.wU).activeMenu;function Q(e){var t;return e?{label:null===(t=e.translation)||void 0===t?void 0:t.title,value:e.id,open_time:e.open_time,close_time:e.close_time}:null}var R=function(e,t){var d={payment_sys_id:t.value};w(!0),m.Z.update(I,e).then((function(e){!function(e,t){D.Z.create(e,t).then((function(e){N(e.data.id),h((0,k.bn)())})).finally((function(){return w(!1)}))}(e.data.id,d)})).catch((function(){return w(!1)}))};return(0,r.useEffect)((function(){L.refetch&&(V(!0),m.Z.getById(I).then((function(e){var t,n,r,a,o=e.data;h((0,k.oM)({calculate:!0}));var l,u=o.details.map((function(e){var t;return(0,i.Z)((0,i.Z)({},e.stock.product),{},{stocks:e.stock.extras,stock:e.stock,stockID:e.stock,quantity:e.quantity,img:null===(t=e.stock.product)||void 0===t?void 0:t.img,price:e.stock.price,bonus:e.bonus,addons:e.addons})})),s={product_tax:null===o||void 0===o||null===(t=o.details)||void 0===t||null===(n=t.flatMap((function(e){return e.total_price})))||void 0===n?void 0:n.reduce((function(e,t){return e+t})),shop_tax:o.tax,order_total:o.total_price};h((0,k.r3)(u)),h((0,k.B4)(u)),h((0,k.rU)(s)),h((0,k.dY)(o.currency)),h((0,b.nc)({activeMenu:L,data:(0,i.Z)((0,i.Z)({},L.data),{},{addressData:{address:o.address.address,lat:o.location.latitude,lng:o.location.longitude}})})),h((0,k.oM)({userUuid:o.user.uuid,shop:Q(o.shop),delivery_type:o.delivery_type,delivery_fee:o.delivery_fee,delivery_date:JSON.stringify(o.delivery_date),delivery_time:o.delivery_time,address:{address:o.address.address,lat:o.location.latitude,lng:o.location.longitude},currency:{id:o.currency.payment_system},payment_type:o.transaction,deliveries:{label:o.delivery_type}})),d.setFieldsValue({delivery_time:Z()(null===o||void 0===o?void 0:o.delivery_time,"HH:mm:ss"),delivery_date:Z()(o.delivery_date,"YYYY-MM-DD"),user:(l=o.user,{label:l.firstname+" "+(l.lastname||""),value:l.id,uuid:l.uuid}),currency_id:o.currency.id,payment_type:{label:(null===(r=o.transaction)||void 0===r?void 0:r.payment_system.tag)||"cash",value:(null===(a=o.transaction)||void 0===a?void 0:a.payment_system.id)||1},note:o.note,delivery:{label:o.delivery_type,value:o.shop.price}})})).finally((function(){V(!1),h((0,b.A_)(L))})))}),[L.refetch]),(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(o.Z,{title:e("edit.order"),extra:(0,M.jsx)(l.Z,{type:"primary",loading:H,onClick:function(){return d.submit()},disabled:!(null!==z&&void 0!==z&&z.length),children:e("save")})}),(0,M.jsxs)(a.Z,{name:"order-form",form:d,layout:"vertical",onFinish:function(e){var t,d,i,n,r,a=function(e){var t=null===e||void 0===e?void 0:e.map((function(e){var t,d;return{quantity:e.quantity,stock_id:e.stockID?null===(t=e.stockID)||void 0===t?void 0:t.id:null===(d=e.stock)||void 0===d?void 0:d.id}})),d=null===e||void 0===e?void 0:e.flatMap((function(e){var t;return null===(t=e.addons)||void 0===t?void 0:t.map((function(t,d){var i,n;return{quantity:t.quantity,stock_id:t.stock_id,parent_id:e.stockID?null===(i=e.stockID)||void 0===i?void 0:i.id:null===(n=e.stock)||void 0===n?void 0:n.id}}))}));return t.concat(d)}(G),o={currency_id:e.currency_id,rate:null===(t=K.find((function(t){return t.id===e.currency_id})))||void 0===t?void 0:t.rate,shop_id:J.shop.value,delivery_id:e.delivery.label,delivery_fee:J.delivery_fee,coupon:$.coupon,tax:P.order_tax,payment_type:null===(d=e.payment_type)||void 0===d?void 0:d.label,note:e.note,delivery_date:Z()(e.delivery_date).format("YYYY-MM-DD"),address:{address:null===(i=L.data.addressData)||void 0===i?void 0:i.address,office:null,house:null,floor:null},location:{latitude:null===(n=L.data.addressData)||void 0===n?void 0:n.lat,longitude:null===(r=L.data.addressData)||void 0===r?void 0:r.lng},delivery_time:Z()(J.delivery_time,"HH:mm").format("HH:mm"),delivery_type:J.delivery_type,products:a};R(o,e.payment_type)},className:"order-add",initialValues:{user:J.user||void 0,address:J.address||null,currency_id:J.currency.id,payment_type:J.payment_type||null},children:[(0,M.jsxs)(u.Z,{gutter:24,hidden:O,children:[(0,M.jsx)(s.Z,{span:16,children:(0,M.jsx)(p.Z,{form:d})}),(0,M.jsxs)(s.Z,{span:8,children:[(0,M.jsx)(v.Z,{form:d}),(0,M.jsx)(y.Z,{form:d})]})]}),O&&(0,M.jsx)("div",{className:"loader",children:(0,M.jsx)(c.Z,{})})]}),S?(0,M.jsx)(_.Z,{orderId:S,handleClose:function(){N(null);var e="orders";h((0,b.ph)((0,i.Z)((0,i.Z)({},L),{},{nextUrl:e}))),Y("/".concat(e)),h((0,g.AU)())}}):""]})}}}]);