"use strict";(self.webpackChunkgithubit_dashboard=self.webpackChunkgithubit_dashboard||[]).push([[6124],{16124:function(e,t,n){n.r(t);var r=n(4942),i=n(93433),a=n(1413),s=n(29439),u=n(47313),l=n(58467),c=n(34491),o=n(18197),d=n(77181),f=n(68197),p=n(59624),m=n(59491),h=n(2717),v=n(90954),Z=n(18333),x=n(89281),j=n(24511),g=n(4446),b=n(84980),y=n(51282),w=n(21249),_=n(46417);t.default=function(){var e,t,n=(0,j.$)().t,F=(0,h.v9)((function(e){return e.menu}),h.wU).activeMenu,S=(0,h.I0)(),k=o.Z.useForm(),N=(0,s.Z)(k,1)[0],L=(0,l.s0)(),O=(0,l.UO)().id,U=(0,h.v9)((function(e){return e.myShop}),h.wU).myShop,q=(0,u.useState)(null!==(e=F.data)&&void 0!==e&&e.images?[null===(t=F.data)||void 0===t?void 0:t.images[0]]:[]),I=(0,s.Z)(q,2),A=I[0],R=I[1],T=(0,u.useState)(!1),V=(0,s.Z)(T,2),C=V[0],D=V[1],E=(0,u.useState)(!1),M=(0,s.Z)(E,2),P=M[0],$=M[1];(0,u.useEffect)((function(){return function(){var e=N.getFieldsValue(!0);S((0,v.nc)({activeMenu:F,data:e}))}}),[]);var B=function(e){return e.map((function(e){return{name:e,url:e}}))};return(0,u.useEffect)((function(){var e;F.refetch&&(e=O,$(!0),g.Z.getById(e).then((function(e){var t=e.data;N.setFieldsValue((0,a.Z)((0,a.Z)({},t),{},{image:B(t.file_urls),products:{label:t.product.translation.title,value:t.product.id}})),R(B(t.file_urls))})).finally((function(){$(!1),S((0,v.A_)(F))})))}),[F.refetch]),(0,_.jsx)(d.Z,{title:n("edit.story"),className:"h-100",children:P?(0,_.jsx)(y.Z,{}):(0,_.jsxs)(o.Z,{name:"story-add",layout:"vertical",onFinish:function(e){var t=(0,a.Z)((0,a.Z)({},Object.assign.apply(Object,[{}].concat((0,i.Z)(A.map((function(e,t){return(0,r.Z)({},"file_urls[".concat(t,"]"),e.name)})))))),{},{product_id:e.products.value});D(!0);var s="seller/stories";g.Z.update(O,t).then((function(){var e={shop_id:U.id};c.Am.success(n("successfully.updated")),S((0,v.ph)((0,a.Z)((0,a.Z)({},F),{},{nextUrl:s}))),L("/".concat(s)),S((0,b.U7)(e))})).finally((function(){return D(!1)}))},form:N,initialValues:(0,a.Z)({active:!0},F.data),className:"d-flex flex-column h-100",children:[(0,_.jsxs)(f.Z,{gutter:12,children:[(0,_.jsx)(p.Z,{span:24,children:(0,_.jsx)(o.Z.Item,{label:n("image"),name:"image",rules:[{required:A.length<0,message:n("required")}],children:(0,_.jsx)(w.Z,{form:N,setFileList:R,fileList:A})})}),(0,_.jsx)(p.Z,{span:24,children:(0,_.jsx)(o.Z.Item,{label:n("products"),name:"products",rules:[{required:!0,message:n("required")}],children:(0,_.jsx)(x.h,{fetchOptions:function(e){var t={search:e,shop_id:U.id,status:"published",active:1,rest:1};return Z.Z.getAll(t).then((function(e){return e.data.map((function(e){return{label:e.translation.title,value:e.id,key:e.id}}))}))},debounceTimeout:200})})})]}),(0,_.jsx)("div",{className:"flex-grow-1 d-flex flex-column justify-content-end",children:(0,_.jsx)("div",{className:"pb-5",children:(0,_.jsx)(m.Z,{type:"primary",htmlType:"submit",loading:C,children:n("submit")})})})]})})}},21249:function(e,t,n){n.d(t,{Z:function(){return Z}});var r=n(93433),i=n(74165),a=n(15861),s=n(29439),u=n(47313),l=n(72652),c=n(15178),o=n(84695),d=n(82138),f=n(24511),p=n(34344),m={upload:function(e){return p.Z.post("dashboard/seller/stories/upload",e)}},h=n(46417),v=function(e){return new Promise((function(t,n){var r=new FileReader;r.readAsDataURL(e),r.onload=function(){return t(r.result)},r.onerror=function(e){return n(e)}}))},Z=function(e){var t=e.fileList,n=e.setFileList,p=e.form,Z=(0,f.$)().t,x=(0,u.useState)(!1),j=(0,s.Z)(x,2),g=j[0],b=j[1],y=(0,u.useState)(""),w=(0,s.Z)(y,2),_=w[0],F=w[1],S=(0,u.useState)(""),k=(0,s.Z)(S,2),N=k[0],L=k[1],O=(0,u.useState)(!1),U=(0,s.Z)(O,2),q=U[0],I=U[1],A=function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.url||t.preview){e.next=4;break}return e.next=3,v(t.originFileObj);case 3:t.preview=e.sent;case 4:F(t.url||t.preview),b(!0),L(t.name||t.url.substring(t.url.lastIndexOf("/")+1));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),R=function(e){return{uid:e[0],name:e[0],status:"done",url:e[0],created:!0}},T=q?(0,h.jsx)("div",{children:(0,h.jsx)(l.Z,{})}):(0,h.jsxs)("div",{children:[(0,h.jsx)(d.Z,{className:"upload_plus"}),(0,h.jsx)("div",{style:{marginTop:8},children:(0,h.jsx)("span",{className:"upload_text",children:Z("upload")})})]});return(0,h.jsxs)("div",{className:"story_img",children:[(0,h.jsx)(c.Z,{listType:"picture-card",fileList:t,onPreview:A,customRequest:function(e){var i=e.file,a=e.onSuccess;I(!0);var s=new FormData;s.append("files[0]",i),m.upload(s).then((function(e){var i=e.data;n((function(e){return[].concat((0,r.Z)(e),[R(i)])})),p.setFieldsValue({images:[].concat((0,r.Z)(t),[R(i)])}),a("ok")})).finally((function(){I(!1)}))},onRemove:function(e){n((function(t){return t.filter((function(t){return t.uid!==e.uid}))}))},children:t.length>=24?null:T}),(0,h.jsx)(o.Z,{visible:g,title:N,footer:null,onCancel:function(){return b(!1)},children:(0,h.jsx)("img",{alt:"example",style:{width:"100%"},src:_})})]})}}}]);